<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/chat.css">
    <link rel="stylesheet" href="css/icon-font.css">
    <title>Мессенджер</title>
  </head>
  <body>
    <main class="main">
      <div class="chat-container">
        <div class="chat-list">
          <div class="chat-list__header">
            <div class="chat-list__profile-link">
              <a class="chat-link" href="profile.html">Профиль</a>
            </div>
            <div class="chat-list-search">
              <span class="chat-list-search__icon icon icon-search-solid"></span>
              <input class="chat-list-search__input" id="chat-list-search" type="text" placeholder="Поиск">
            </div>
          </div>

          <div id="chat-list-container" class="chat-list__body">

          </div>

        </div>
        <div id="chat-body" class="chat-body">

        </div>
      </div>
    </main>

    <div id="input-popup"></div>
    <div id="file-popup"></div>
    <div id="button-popup"></div>

    <script type="text/x-handlebars-template" id="chat-list-template">
      <ul id="chat-list" class="chat-list__list">

        {{#each chatsList}}
          <li id="{{ this.id }}" class="chat-list__item chat-list-item">
            <div class="chat-list-item__image">
              <span>{{ this.firstLetter }}</span>
            </div>
            <div class="chat-list-item__body">
              <div class="chat-list-item__title">
                <div class="chat-list-item__name">{{ this.name }}</div>
                <div class="chat-list-item__time">{{ this.time }}</div>
              </div>
              <div class="chat-list-item__text">
                <div class="chat-list-item__message">
                  {{#if this.yourMessageFlag}}
                    <span class="chat-list-item__message-you">Вы: </span>
                  {{/if }}
                  {{ this.message }}
                </div>
                {{#if this.notReadCount}}
                  <div class="chat-list-item__count">{{ this.notReadCount }}</div>
                {{/if}}
              </div>
            </div>
          </li>
        {{/each}}

      </ul>
    </script>

    <script type="text/x-handlebars-template" id="chat-template">
      {{#if slectedChat}}
      <div class="message-feed__header">
        <div class="message-feed__avatar chat-avatar">
          <div class="message-feed__avatar-img chat-avatar__img">
            <span>{{ chatFirstLetter }}</span>
          </div>
          <div class="message-feed__avatar-name chat-avatar__name">
            {{ chatName }}
          </div>
        </div>

        <div class="message-feed__header-menu" data-dropdown>
          <button class="icon icon-ellipsis-h-solid" data-dropdown-btn></button>

          <div class="message-feed__header-dropdown message-feed__tooltip" data-dropdown-body>
            <ul>
              <li>
                <button data-btn-action="add-user">
                  <span class="icon icon-plus-circle-solid"></span>
                  Добавить пользователя
                </button>
              </li>
              <li>
                <button data-btn-action="remove-user">
                  <span class="icon icon-minus-circle-solid"></span>
                  Удалить пользователя
                </button>
              </li>
              <li>
                <button data-btn-action="remove-chat">
                  <span class="icon icon-trash-alt-solid"></span>
                  Удалить чат
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="message-feed__main message-feed-main">
        <ul class="message-feed-main__container">

          {{#each messageList}}
            {{#if this.yourMessageFlag}}
            <li class="message-feed-main__row message-feed-main__row_right">
              <div class="message-feed__message-block">
                {{#if this.imageSrc}}
                <div class="message-feed__message-block-image">
                  <img src="{{ this.imageSrc }}" alt="">
                </div>
                {{/if}}
                <div class="message-feed__message-block-text">{{ this.text }}</div>
                <div class="message-feed__message-block-time">
                  <span>{{ this.time }}</span>
                  {{#if deliveredFlag}}
                  <span class="message-feed__message-block-status icon icon-angle-double-right-solid"></span>
                  {{/if}}
                </div>
              </div>
            </li>
            {{else}}
            <li class="message-feed-main__row message-feed-main__row_left">
              <div class="message-feed__message-block">
                {{#if this.imageSrc}}
                <div class="message-feed__message-block-image">
                  <img src="{{ this.imageSrc }}" alt="">
                </div>
                {{/if}}
                <div class="message-feed__message-block-text">{{ this.text }}</div>
                <div class="message-feed__message-block-time">
                  <span>{{ this.time }}</span>
                </div>
              </div>
            </li>
            {{/if}}
          {{/each}}
        </ul>
      </div>

      <div class="message-feed__footer">
        <div class="message-feed__footer-menu" data-dropdown>
          <button class="icon icon-paperclip-solid" data-dropdown-btn></button>

          <div class="message-feed__footer-dropdown message-feed__tooltip" data-dropdown-body>
            <ul>
              <li>
                <button data-btn-action="send-photo">
                  <span class="icon icon-images-solid"></span>
                  Фото или Видео
                </button>
              </li>
              <li>
                <button data-btn-action="send-file">
                  <span class="icon icon-file-solid"></span>
                  Файл
                </button>
              </li>
              <!-- <li>
                <button data-btn-action="send-location">
                  <span class="icon icon-map-marked-alt-solid"></span>
                  Локация
                </button>
              </li> -->
            </ul>
          </div>
        </div>

        <form id="message-form" class="message-feed__footer-form">
          <textarea class="message-feed__footer-input" name="message" placeholder="Введите сообщение..."></textarea>
          <div data-component="submit-btn"></div>
        </form>
      </div>
      {{else}}
      <div class="chat-body__placeholder">
        <p>Выберите чат чтобы начать общение</p>
      </div>
      {{/if}}
    </script>

    <script src="js/libs/handlebars.min-v4.7.6.js"></script>
    <script src="js/pages/chat.js" type="module"></script>
  </body>
</html>
